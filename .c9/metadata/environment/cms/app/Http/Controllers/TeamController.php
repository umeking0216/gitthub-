{"filter":false,"title":"TeamController.php","tooltip":"/cms/app/Http/Controllers/TeamController.php","undoManager":{"mark":19,"position":19,"stack":[[{"start":{"row":4,"column":28},"end":{"row":5,"column":0},"action":"insert","lines":["",""],"id":37}],[{"start":{"row":5,"column":0},"end":{"row":8,"column":24},"action":"insert","lines":["use App\\Models\\Team; //この行を上に追加","use App\\Models\\User;//この行を上に追加","use Auth;//この行を上に追加","use Validator;//この行を上に追加"],"id":38}],[{"start":{"row":12,"column":4},"end":{"row":12,"column":6},"action":"remove","lines":["//"],"id":39},{"start":{"row":12,"column":4},"end":{"row":15,"column":7},"action":"insert","lines":[" public function index()","    {","        return view('teams');","    }  "]}],[{"start":{"row":15,"column":7},"end":{"row":16,"column":0},"action":"insert","lines":["",""],"id":40},{"start":{"row":16,"column":0},"end":{"row":16,"column":4},"action":"insert","lines":["    "]},{"start":{"row":16,"column":4},"end":{"row":17,"column":0},"action":"insert","lines":["",""]},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]},{"start":{"row":17,"column":4},"end":{"row":18,"column":0},"action":"insert","lines":["",""]},{"start":{"row":18,"column":0},"end":{"row":18,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":17,"column":4},"end":{"row":39,"column":1},"action":"insert","lines":["public function store(Request $request){","","    //バリデーション ","    $validator = Validator::make($request->all(), [","        'team_name' => 'required|max:255'","    ]);","    ","    //バリデーション:エラー","    if ($validator->fails()) {","        return redirect('/')","            ->withInput()","            ->withErrors($validator);","    }","    ","    //以下に登録処理を記述（Eloquentモデル）","    $teams = new Team;","    $teams->team_name = $request->team_name;","    $teams->user_id = Auth::id();//ここでログインしているユーザidを登録しています","    $teams->save();","    ","    return redirect('/teams');","","}"],"id":41}],[{"start":{"row":16,"column":4},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":42},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":13,"column":0},"end":{"row":13,"column":4},"action":"remove","lines":["    "],"id":43},{"start":{"row":12,"column":28},"end":{"row":13,"column":0},"action":"remove","lines":["",""]}],[{"start":{"row":13,"column":8},"end":{"row":13,"column":29},"action":"remove","lines":["return view('teams');"],"id":44},{"start":{"row":13,"column":8},"end":{"row":16,"column":43},"action":"insert","lines":["//本の全件データ取得","    $teams = Team::get();","","    return view('teams',['teams'=>$teams]);"]}],[{"start":{"row":16,"column":43},"end":{"row":17,"column":0},"action":"insert","lines":["",""],"id":45},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":43,"column":1},"end":{"row":44,"column":0},"action":"insert","lines":["",""],"id":47},{"start":{"row":44,"column":0},"end":{"row":45,"column":0},"action":"insert","lines":["",""]},{"start":{"row":45,"column":0},"end":{"row":46,"column":0},"action":"insert","lines":["",""]},{"start":{"row":46,"column":0},"end":{"row":47,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":45,"column":0},"end":{"row":58,"column":1},"action":"insert","lines":["public function join($team_id)","{","    //ログイン中のユーザーを取得","    $user = Auth::user();","    ","    //お気に入りする記事","    $team = Team::find($team_id);","    ","    //リレーションの登録","    $team->members()->attach($user);","    ","    return redirect('/teams');","    ","}"],"id":49}],[{"start":{"row":39,"column":19},"end":{"row":40,"column":0},"action":"insert","lines":["",""],"id":50},{"start":{"row":40,"column":0},"end":{"row":40,"column":4},"action":"insert","lines":["    "]},{"start":{"row":40,"column":4},"end":{"row":41,"column":0},"action":"insert","lines":["",""]},{"start":{"row":41,"column":0},"end":{"row":41,"column":4},"action":"insert","lines":["    "]}],[{"start":{"row":41,"column":4},"end":{"row":41,"column":46},"action":"insert","lines":["$teams->members()->attach( Auth::user() );"],"id":51}],[{"start":{"row":40,"column":4},"end":{"row":40,"column":22},"action":"insert","lines":["//多対多のリレーションもここで登録"],"id":52}],[{"start":{"row":61,"column":0},"end":{"row":62,"column":0},"action":"insert","lines":["",""],"id":53},{"start":{"row":62,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["",""]},{"start":{"row":63,"column":0},"end":{"row":64,"column":0},"action":"insert","lines":["",""]}],[{"start":{"row":63,"column":0},"end":{"row":68,"column":1},"action":"insert","lines":["//チーム編集画面表示","public function edit (Team $team) {","        ","   return view('teamsedit', ['team' => $team]);","        ","}"],"id":54}],[{"start":{"row":70,"column":0},"end":{"row":71,"column":0},"action":"insert","lines":["",""],"id":55}],[{"start":{"row":70,"column":0},"end":{"row":92,"column":1},"action":"insert","lines":["/更新処理","public function update (Request $request) {","        ","         //バリデーション ","        $validator = Validator::make($request->all(), [","            'team_name' => 'required|max:255',","        ]);","        ","        //バリデーション:エラー","        if ($validator->fails()) {","            return redirect('/')","                ->withInput()","                ->withErrors($validator);","        }","        ","        //対象のチームを取得","        $team = Team::find($request->id);","        $team->team_name = $request->team_name;","        $team->save();","        ","        return redirect('/teams');","        ","}"],"id":56}],[{"start":{"row":70,"column":0},"end":{"row":70,"column":1},"action":"insert","lines":["/"],"id":57}],[{"start":{"row":41,"column":4},"end":{"row":41,"column":46},"action":"remove","lines":["$teams->members()->attach( Auth::user() );"],"id":58},{"start":{"row":41,"column":4},"end":{"row":41,"column":80},"action":"insert","lines":[" $teams->members()->attach( Auth::user(),['role'=>'owner'] );//<-ここが変わってるよ！！"]}]]},"ace":{"folds":[],"scrolltop":400.2000000000013,"scrollleft":0,"selection":{"start":{"row":43,"column":30},"end":{"row":43,"column":30},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1676297964545,"hash":"44f6e283826eb8b3f2c581613110ace2df5c9a33"}